# Garmingps

Garmingps — это веб-приложение на базе Spring Boot, предназначенное для генерации GPX-файлов (GPS Exchange Format) из координатных данных. Позволяет создавать треки и маршруты для использования в GPS-устройствах и приложениях.

## Возможности

- Генерация файлов в формате GPX 1.1
- Простой веб-интерфейс
- REST API для генерации GPX

## Использованные технологии

- Spring Boot
- Java 21
- JAXB

## Быстрый старт

### Сборка приложения

```bash
mvn clean package -DskipTests spring-boot:repackage
```

### Запуск приложения

```bash
mvn spring-boot:run
```

### Веб-интерфейс

Доступен по адресу `http://localhost:8060`
- Добавление координатных точек для построения маршрута
- Загрузка массива координатных данных для построения маршрута
- Скачивание сгенерированных GPX-файлов

## Запуск в Docker

Для развертывания с помощью Docker:

```bash
docker-compose up -d
```

## API

Базовый URL: `http://localhost:8060`

Форматы:
- Запросы: application/json
- Успешный ответ: application/octet-stream, заголовок Content-Disposition: attachment; filename="track.gpx" (содержимое GPX 1.1)
- Ошибка: 500, application/json вида { "Ошибка": "<сообщение>" }

Эндпоинты:

1) POST /create — генерация GPX по структуре координат
- Тело запроса: JSON-массив объектов Coordinate
  {
    "lat": "<H> <D>°<M>′",
    "lon": "<H> <D>°<M>′"
  }
  где:
  - H — N/S для широты, E/W для долготы
  - D — градусы (целое число)
  - M — минуты с дробной частью
  - Символы градусов и минут — соответственно ° и ′ (U+2032)
- Пример:
```
POST /create
Content-Type: application/json

[
  {"lat":"N 59°52.869′","lon":"E 30°19.741′"},
  {"lat":"N 59°53.102′","lon":"E 30°20.115′"}
]
```
- Пример cURL (сохранение результата в файл):
```
curl -X POST "http://localhost:8080/create" \
  -H "Content-Type: application/json" \
  -d '[
    {"lat":"N 59°52.869′","lon":"E 30°19.741′"},
    {"lat":"N 59°53.102′","lon":"E 30°20.115′"}
  ]' \
  -o track.gpx
```

2) POST /text — генерация GPX из текстовых строк
- Тело запроса: JSON-массив строк. Первая строка игнорируется (может быть заголовком).
- Каждая последующая строка должна содержать 5 токенов, разделённых пробелом:
  "<index> <latHem> <latDMS> <lonHem> <lonDMS>"
  где latHem ∈ {N,S}, lonHem ∈ {E,W}, latDMS/ lonDMS имеют формат "D°M′".
- Пример тела запроса:
```
POST /text
Content-Type: application/json
[
  "header",                     
  "1 N 59°52.869′ E 30°19.741′",
  "2 N 59°53.102′ E 30°20.115′"
]
```
- Пример cURL:
```
curl -X POST "http://localhost:8080/text" \
  -H "Content-Type: application/json" \
  -d '[
    "header",
    "1 N 59°52.869′ E 30°19.741′",
    "2 N 59°53.102′ E 30°20.115′"
  ]' \
  -o track.gpx
```

## Telegram Bot

Приложение включает в себя Telegram бота для удобного создания GPX-треков прямо в мессенджере.

### Возможности бота

- Конвертация текстовых координат в GPX-трек
- Поддержка формата ввода: `N 59°52.869′ E 30°19.741′`
- Отправка сгенерированных GPX-файлов в чат

### Как использовать

1. Найдите бота в Telegram по имени `@имя_бота`
2. Отправьте боту координаты в формате:
   ```
    header
    1 N 59°52.869′ E 30°19.741′
    2 N 59°53.102′ E 30°20.115′
   ```
3. Бот обработает координаты и отправит GPX-файл с треком

### Настройка бота

1. Создайте бота через [@BotFather](https://t.me/botfather)
2. Полученный токен добавьте в `application.yml`:
   ```yaml
   telegram:
     bot:
       token: ваш_токен_бота
       name: имя_бота
   ```

## Примечания:
- Должна быть минимум одна пара координат, иначе вернётся ошибка (500) с описанием.
- Сервис приводит координаты к десятичному формату с точностью до 6 знаков после запятой.
- Метаданные, маршрутные точки и временные метки треков формируются автоматически; время между точками трека увеличивается на 5 минут.

## Лицензия

Проект распространяется под лицензией Apache 2.0.
